{% extends 'layout.html' %}
{% block content %}

{% from "navigation.html" import homepage_tabs %}
{{ homepage_tabs('national') }}

  <h1>Objectives</h1>

  <div class="tabbable tabs-left">

    <ul class="nav nav-tabs">
      {% for objective_id in objective_ids %}
        {% set active = 'active' if objective_id.id == objective.id %}
        <li class={{ active }}>
        <a href="{{ url_for('objectives.homepage_objectives', objective_id=objective_id.id) }}">
          {{ objective_id.id }}
        </a>
        </li>
      {% endfor %}
    </ul>

    <div class="tab-content homepage_view span10" >
      <h3>{{objective.title.en}}</h3>

      <div class="row">
      <ul class="span2 offset1">
        {% for subobj in objective.subobjs|sort(attribute='id') %}
          {% if loop.index0 % 4 == 0 and not loop.first %}
            </ul><ul class="span2 offset1">
          {% endif %}
          <li>
          <a href="#subobjective_{{subobj.id}}">Objective {{objective.id}}.{{subobj.id}}</a>
          </li>
        {% endfor %}
      </ul>
      </div>

      <div class="element_field">
        <h4>Description</h4>
        <div class="snippet">
          {{ objective.body.en|truncate(end='')|safe }}
          <a class="more">... show more</a>
        </div>
        <div class="full">
          {{ objective.body.en|safe }}
          <a class="less">show less</a>
        </div>
        <a href="#top">Back to top</a>
      </div>

      {% for subobj in objective.subobjs|sort(attribute='id') %}
        <div class="element_field" id="subobjective_{{ subobj.id }}">
          <h4>{{subobj.title.en}}</h4>

          <div class="snippet">
            {{subobj.body.en|truncate(end='')|safe }}
            <a class="more">... show more</a>
          </div>
          <div class="full">
            {{ subobj.body.en|safe }}
          <a class="less">show less</a>
          </div>

          {% if subobj.mapping|length() %}
          <div class="row">
            <div class="span2">Mapping with AICHI:</div>
            <ul class="span8">
            {% for m in subobj.mapping %}
                <li>
                  <a href="{{url_for('goals.homepage_goals', goal_short_title=m.goal)}}">
                    goal {{m.goal}}
                  </a>
                  <a href="#">
                    target {{m.main_target}}
                  </a>
                {% for target in m.other_targets %}
                  <a href="#">
                    target {{target}}
                  </a>
                {% endfor %}
                </li>
            {% endfor %}
            </ul>
          </div>
          {% endif %}

          <a href="#top">Back to top</a>
        </div>
      {% endfor %}

    </div>

  </div>

{% endblock content %}
{% block scripts %}
{{ super() }}
<script>
$(function () {
  $('.more').on('click', function() {
    var parents = $(this).parents('.element_field');
    var snippet = parents.find('.snippet');
    var full = parents.find('.full');

    snippet.hide();
    full.show();
  });
  $('.less').on('click', function() {
    var parents = $(this).parents('.element_field');
    var snippet = parents.find('.snippet');
    var full = parents.find('.full');

    full.hide();
    snippet.show();
  });
});

</script>
{% endblock scripts %}
