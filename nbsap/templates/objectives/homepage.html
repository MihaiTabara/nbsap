{% extends 'layout.html' %}
{% block content %}

{% from "navigation.html" import homepage_tabs %}
{{ homepage_tabs('national') }}

  <div class="tabbable tabs-left">

    <ul class="nav nav-tabs nav-stacked">
      <label>Objectives</label>
      {% for objective_id in objective_ids %}
        {% set active = 'active' if objective_id.id == objective.id %}
        <li class={{ active }}>
        <a href="{{ url_for('objectives.homepage_objectives', objective_id=objective_id.id) }}">
          {{ objective_id.id }}
        </a>
        </li>
      {% endfor %}
    </ul>

    <div class="tab-content homepage_view" >
      <h1>{{objective.title.en}}</h1>

      <div class="row">
      <ul class="span2">
        {% for subobj in objective.subobjs|sort(attribute='id') %}
          {% if loop.index0 % 4 == 0 and not loop.first %}
            </ul><ul class="span2">
          {% endif %}
          <li>
          <a href="#subobjective_{{subobj.id}}">Objective {{objective.id}}.{{subobj.id}}</a>
          </li>
        {% endfor %}
      </ul>
      </div>

      <div class="element_field">
        <h2>Description</h2>
        <div class="snippet">
          {{ objective.body.en|truncate(end='')|markdown }}
          <a class="more">... show more</a>
        </div>
        <div class="full">
          {{ objective.body.en|markdown }}
          <a class="less">show less</a>
        </div>
        <a class="pull-right" href="#top">Back to top</a>
      </div>

      {% for subobj in objective.subobjs|sort(attribute='id') %}
        <div class="element_field" id="subobjective_{{ subobj.id }}">
          <h2>{{subobj.title.en}}</h2>

          <div class="snippet">
            {{subobj.body.en|truncate(end='')|markdown }}
            <a class="more">... show more</a>
          </div>
          <div class="full">
            {{ subobj.body.en|markdown }}
          <a class="less">show less</a>
          </div>


            <label>Mapping with AICHI:</label>

            <div class="row well">
          {% if subobj.mapping|length() %}
            {% for m in subobj.mapping %}
            <ul class="span3">

                <li>Goal: <a href="{{url_for('goals.homepage_goals', goal_short_title=m.goal)}}">
                    goal {{m.goal}}
                </a></li>

                <li>Most relevant target: <a href="{{url_for('goals.homepage_goals',
                  goal_short_title=mapping[m.main_target], _anchor="target_%s" % m.main_target)}}">
                    target {{m.main_target}}
                </a></li>

                {% if m.other_targets %}
                  <li>Other relevant targets:
                  {% for target in m.other_targets %}
                    <a href="{{url_for('goals.homepage_goals',
                    goal_short_title=mapping[target], _anchor="target_%s" % target)}}">
                      target {{target}}{% if not loop.last %},{% endif %}
                  </a>
                  {% endfor %}
                  </li>
                {% endif %}

            </ul>
            {% endfor %}
          {% else %}
            None
          {% endif %}
            </div>


          <a class="pull-right" href="#top">Back to top</a>
        </div>
      {% endfor %}

    </div>

  </div>

{% endblock content %}
{% block scripts %}
{{ super() }}
<script>
$(function () {
  $('.more').on('click', function() {
    var parents = $(this).parents('.element_field');
    var snippet = parents.find('.snippet');
    var full = parents.find('.full');

    snippet.hide();
    full.show();
  });
  $('.less').on('click', function() {
    var parents = $(this).parents('.element_field');
    var snippet = parents.find('.snippet');
    var full = parents.find('.full');

    full.hide();
    snippet.show();
  });
});

</script>
{% endblock scripts %}
